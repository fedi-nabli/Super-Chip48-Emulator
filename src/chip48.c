#include "chip48.h"
#include <memory.h>
#include <assert.h>

const char chip48_default_character_set[] = {
  0xf0, 0x90, 0x90, 0x90, 0xf0,
  0x20, 0x60, 0x20, 0x20, 0x70,
  0xf0, 0x10, 0xf0, 0x80, 0xf0,
  0xf0, 0x10, 0xf0, 0x10, 0xf0,
  0x90, 0x90, 0xf0, 0x10, 0x10,
  0xf0, 0x80, 0xf0, 0x10, 0xf0,
  0xf0, 0x80, 0xf0, 0x90, 0xf0,
  0xf0, 0x10, 0x20, 0x40, 0x40,
  0xf0, 0x90, 0xf0, 0x90, 0xf0,
  0xf0, 0x90, 0xf0, 0x10, 0xf0,
  0xf0, 0x90, 0xf0, 0x90, 0x90,
  0xe0, 0x90, 0xe0, 0x90, 0xe0,
  0xf0, 0x80, 0x80, 0x80, 0xf0,
  0xe0, 0x90, 0x90, 0x90, 0xe0,
  0xf0, 0x80, 0xf0, 0x80, 0xf0,
  0xf0, 0x80, 0xf0, 0x80, 0x80
};

void chip48_init(struct chip48* chip48)
{
  memset(chip48, 0, sizeof(struct chip48));
  memcpy(&chip48->memory.memory, chip48_default_character_set, sizeof(chip48_default_character_set));
}

void chip48_load(struct chip48* chip48, const char* buf, size_t size)
{
  assert(size+CHIP48_PROGRAM_LOAD_ADDRESS < CHIP48_MEMORY_SIZE);
  memcpy(&chip48->memory.memory[CHIP48_PROGRAM_LOAD_ADDRESS], buf, size);
  chip48->registers.PC = CHIP48_PROGRAM_LOAD_ADDRESS;
}

void chip48_exec(struct chip48* chip48, unsigned short opcode)
{}